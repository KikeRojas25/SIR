
<div class="flex flex-col flex-auto min-w-0">


  <div class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">
    <div class="flex-1 min-w-0">
      <div  class="flex flex-wrap items-center font-medium">
        <div>
          <a  class="whitespace-nowrap text-primary-500">SIR</a>
        </div>
        <div class="flex items-center ml-1 whitespace-nowrap">
              <mat-icon
              class="fuse-horizontal-navigation-item-icon"
              [svgIcon]="'heroicons_solid:chevron-right'"></mat-icon>
              <a  class="ml-1 text-primary-500">Reparación</a>
          </div>
      </div>
          <div class="mt-2"><h2  class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 truncate"> Seguimiento de reparaciones </h2>
      </div>
  </div>
  </div>


  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">
  
  
        <div class=" flex flex-col">
          <label for="rubro" class="font-bold">Estado:</label>
          <p-dropdown name="estados" 
          [options]="estados" 
          [(ngModel)]="model.idestado" 
          [scrollHeight]="'200px'"
          [showClear]="true" 
          [style]="{'width': '100%', 'min-width' : '250px'}" 
          [resetFilterOnHide]="false"
          [hideTransitionOptions]="'0ms'"
          [showTransitionOptions]="'0ms'"
            placeholder="Seleccione un estado" 
            >
            <ng-template let-item pTemplate="selectedItem">
              <span style="vertical-align:left;">{{item.label}}</span>
          </ng-template>
          
          </p-dropdown>
        </div>
        <div class="flex items-center gap-2 mb-4">
          <p-checkbox
            inputId="disableDates"
            binary="true"
            [(ngModel)]="deshabilitarFechas"
          ></p-checkbox>
          <label for="disableDates">Fechas desactivadas</label>
        </div>
        

        <div class=" flex flex-col">
          <label for="rubro" class="font-bold">Inicio:</label>
          <p-calendar  [(ngModel)]="model.dateinicio"  [disabled]="deshabilitarFechas"  dateFormat="dd.mm.yy" />  
        </div>
        
        <div class=" flex flex-col">
          <label for="rubro" class="font-bold">Fin:</label>
          <p-calendar  [(ngModel)]="model.datefin"  [disabled]="deshabilitarFechas"  dateFormat="dd.mm.yy" />  
        </div>

        <div class="flex flex-col">
          <label for="os" class="font-bold">N° Orden de servicio:</label>
          <input id="os" type="text" pInputText [(ngModel)]="model.os" />
        </div>


        <div class="flex flex-col">
          <label for="serie" class="font-bold">N° Serie:</label>
          <input id="serie" type="text" pInputText [(ngModel)]="model.serie" />
        </div>

        
      <!-- Buscar Button -->
      <div class=" flex flex-col mt-3">
        <p-button severity="success"   label="Buscar" icon="fa fa-search"  (click)="buscar()" 
         ></p-button>
      </div>  
      

</div>  

<div class="flex flex-col p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">



  
  <p-table class="custom-table" [columns]="cols" [scrollable]="true" [style]="{width:'100%'}"
  sortField="idordenserviciotecnico" [value]="ordenes" #dt [paginator]="true"
  dataKey="idordenserviciotecnico" selectionMode="single"
  [rowsPerPageOptions]="[20,40,60,90, 120]"
  [tableStyle]="{ 'table-layout': 'fixed', 'width': '100%' }"
  [globalFilterFields]="['nU_ORDE_COMP','dE_ITEM']"
  [rows]="20"  [responsive]="true">


    <ng-template pTemplate="header" let-columns>
      <tr>
          <th style="text-align: center; color: white;" [ngStyle]="{'width': col.width, 'background-color': col.backgroundcolor }" *ngFor="let col of columns" pResizableColumn [pSortableColumn]="col.field">
              {{col.header}}
          </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData let-columns="columns" let-editing="editing" let-rowIndex="rowIndex">
      <tr [pSelectableRow]="rowData">

        <td class="ui-resizable-column">
          <p-button 
          size="small" 
          [disabled]="rowData.ostestado === 'Cerrada'" 
          [label]="getButtonLabel(rowData.ostestado)" 
          icon="pi pi-user" 
          (click)="asignar(rowData)">
      </p-button>


      <p-button 
      size="small" 
      [disabled]="rowData.ostestado === 'Cerrada'" 
      icon="pi pi-filter"
      (click)="verFiltrado(rowData)">
  </p-button>
      
      </td>
        <td class="ui-resizable-column"> {{ rowData.numeroost }} </td>
    
          <td class="ui-resizable-column"> {{ rowData.producto }} </td>
          <td class="ui-resizable-column"> {{ rowData.serie }} </td>
    
          <td class="ui-resizable-column"  [ngStyle]="{'text-align': 'center', 'vertical-align': 'middle' ,'background-color': getEstadoColor(rowData.ostestado)}"> 
            {{ rowData.ostestado }} 
          </td>
           <td class="ui-resizable-column" [ngStyle]="{ 'text-align': 'center', 'vertical-align': 'middle' }"  > 
            {{ rowData.tiporeparacion }} 
          </td>

            <td class="ui-resizable-column" [ngStyle]="{ 'text-align': 'center', 'vertical-align': 'middle' }"  >
            {{ rowData.fechaRegistro ? (rowData.fechaRegistro | date: 'dd/MM/yyyy') : 'Fecha no disponible' }}
          </td>
          
          <td class="ui-resizable-column" [ngStyle]="{ 'text-align': 'center', 'vertical-align': 'middle' }"  >
            {{ rowData.fechaAsignacion ? (rowData.fechaAsignacion | date: 'dd/MM/yyyy') : 'Fecha no disponible' }}
          </td>
                    
        
          <td class="ui-resizable-column" [ngStyle]="{ 'text-align': 'center', 'vertical-align': 'middle' }"  > {{ rowData.cliente }} </td>
          <td class="ui-resizable-column" [ngStyle]="{ 'text-align': 'center', 'vertical-align': 'middle' }"  > {{ rowData.tecnicoAsignado }} </td>

      </tr>
    </ng-template>
</p-table>




</div>

</div>


<p-dialog header="Asignación a técnico " [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
    <span class="p-text-secondary block mb-8">Con esta opción se puede asignar la orden de servicio y generar una orden de trabajo.</span>
    <p-dropdown 
    [options]="tecnicos" 
    [(ngModel)]="tecnicoSeleccionado" 
    appendTo="body"
    [style]="{'width': '100%'}"
    [showClear]="true"
    [resetFilterOnHide]="false"
    [hideTransitionOptions]="'0ms'"
    [showTransitionOptions]="'0ms'"
    [filter]="true"
    placeholder="Seleccione un técnico">

              <ng-template let-item pTemplate="selectedItem">
                <span>{{ item.label }}</span>
              </ng-template>


</p-dropdown>
    <div class="flex justify-end gap-2">
        <p-button label="Cancelar" severity="secondary" (click)="visible = false" />
        <p-button label="Asignar" (onClick)="confirmarAsignacion()" (click)="visible = false" />
    </div>
</p-dialog>





<p-dialog 
  header="Filtrado de Hardware / Funcionamiento" 
  [(visible)]="visibleFiltrado" 
  [modal]="true" 
  [style]="{ width: '600px' }">

  <p class="text-sm text-gray-600 mb-4">Realice la verificación de la operación realizada por los técnicos.</p>

  <div class="grid grid-cols-2 gap-4 mb-4">
    <div>
      <strong>Hardware</strong>
      <div class="text-2xl">{{ datosQC.ost }}</div>
    </div>

  </div>

  <div class="grid grid-cols-2 gap-4">
    <div *ngFor="let item of preguntasIzquierda">
      <label>{{ item.texto }}</label><br />
    
      <!-- Caso especial: ¿Pruebas de funcionamiento? -->
      <ng-container *ngIf="item.texto === '¿Pruebas de funcionamiento?'; else defaultPregunta">
        
        <!-- Opción Sí -->
        <p-radioButton 
          name="{{item.campo}}" 
          [value]="'si'" 
          [(ngModel)]="respuestas[item.campo]" 
          label="Sí" 
          inputId="{{item.campo}}_si" />
    
        <br />
    
        <!-- Opción Otro con caja de texto en línea -->
        <div class="flex items-center gap-2 mt-1">
          <p-radioButton 
            name="{{item.campo}}" 
            [value]="'otro'" 
            [(ngModel)]="respuestas[item.campo]" 
            label="Otro:" 
            inputId="{{item.campo}}_otro" />
          
          <input 
            pInputText 
            type="text" 
            [disabled]="respuestas[item.campo] !== 'otro'" 
            [(ngModel)]="respuestasOtro[item.campo]" 
            placeholder="Especifique..." 
            class="ml-2" />
        </div>
      </ng-container>
    
      <!-- Para las demás preguntas -->
      <ng-template #defaultPregunta>
        <p-radioButton 
          name="{{item.campo}}" 
          [value]="'true'" 
          [(ngModel)]="respuestas[item.campo]" 
          label="Sí" />
        
        <p-radioButton 
          name="{{item.campo}}" 
          [value]="'false'" 
          [(ngModel)]="respuestas[item.campo]" 
          label="No" />
      </ng-template>
    </div>
    
  </div>
  

  <div class="flex justify-end gap-2 mt-4">
    <p-button label="Guardar" (click)="guardarFiltrado()" />
    <p-button label="Cerrar" severity="secondary" (click)="visible = false" />
  </div>
</p-dialog>



<p-confirmDialog />
<p-toast></p-toast>