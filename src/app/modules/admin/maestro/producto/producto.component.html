<div class="flex flex-col flex-auto min-w-0">
  <!--  TOAST Y CONFIRM -->
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!--  ENCABEZADO -->
  <div class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between p-6 sm:py-4 sm:px-10 border-b bg-card dark:bg-transparent">
    <div class="flex-1 min-w-0">
      <div class="flex flex-wrap items-center font-medium">
        <a class="whitespace-nowrap text-primary-500">SIR</a>
        <div class="flex items-center ml-1 whitespace-nowrap">
          <mat-icon class="fuse-horizontal-navigation-item-icon" [svgIcon]="'heroicons_solid:chevron-right'"></mat-icon>
          <a class="ml-1 text-primary-500">Maestro</a>
        </div>
      </div>
      <div class="mt-1">
        <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 truncate">
          Producto
        </h2>
      </div>
    </div>
  </div>

  <!--  CONTENEDOR PRINCIPAL -->
  <div class="bg-white dark:bg-gray-800 shadow-sm rounded-lg p-6 sm:px-10 border">
    
    <!--  FILTROS -->
    <div class="mb-6">
      <h2 class="text-xl font-bold mb-4">Filtro de b煤squeda</h2>
      <div class="grid grid-cols-1 sm:grid-cols-6 gap-4">

        <!-- C贸digo -->
        <div class="flex flex-col">
          <label class="text-sm font-medium text-gray-700 mb-1">C贸digo</label>
          <div class="relative">
            <input pInputText placeholder="C贸digo" [(ngModel)]="filtro.codigo" class="w-full pr-8" />
            <i *ngIf="filtro.codigo"
               class="pi pi-times absolute right-2 top-1/2 -translate-y-1/2 cursor-pointer text-gray-500"
               (click)="limpiarCampo('codigo')"></i>
          </div>
        </div>

        <!-- Descripci贸n -->
        <div class="flex flex-col">
          <label class="text-sm font-medium text-gray-700 mb-1">Descripci贸n</label>
          <div class="relative">
            <input pInputText placeholder="Descripci贸n" [(ngModel)]="filtro.descripcion" class="w-full pr-8" />
            <i *ngIf="filtro.descripcion"
               class="pi pi-times absolute right-2 top-1/2 -translate-y-1/2 cursor-pointer text-gray-500"
               (click)="limpiarCampo('descripcion')"></i>
          </div>
        </div>

        <!-- Tipo -->
        <div class="flex flex-col">
          <label class="text-sm font-medium text-gray-700 mb-1">Tipo</label>
          <p-dropdown [options]="tipos"
                      [(ngModel)]="filtro.idTipoProducto"
                      optionLabel="label"
                      optionValue="value"
                      placeholder="--Tipo--"
                      class="w-full">
          </p-dropdown>
        </div>

        <!-- Fabricante -->
        <div class="flex flex-col">
          <label class="text-sm font-medium text-gray-700 mb-1">Fabricante</label>
          <p-dropdown [options]="fabricantes"
                      [(ngModel)]="filtro.idFabricante"
                      optionLabel="label"
                      optionValue="value"
                      placeholder="--Fabricante--"
                      class="w-full">
          </p-dropdown>
        </div>

        <!-- Modelo -->
        <div class="flex flex-col">
          <label class="text-sm font-medium text-gray-700 mb-1">Modelo</label>
          <p-dropdown [options]="modelos"
                      [(ngModel)]="filtro.idModelo"
                      optionLabel="label"
                      optionValue="value"
                      placeholder="--Modelo--"
                      class="w-full">
          </p-dropdown>
        </div>

        <!-- Botones Buscar / Nuevo -->
        <div class="flex flex-col">
          <label class="text-sm font-medium text-gray-700 mb-1 invisible">Acciones</label>
          <div class="flex gap-2">
            <button pButton type="button" label="Buscar" class="p-button-primary flex-1" (click)="buscar()"></button>
            <button pButton type="button" label="Nuevo" icon="pi pi-plus" class="p-button-success flex-1"
                    (click)="abrirDialogoNuevo()"></button>
          </div>
        </div>
      </div>
    </div>

    <!--  TABLA DE PRODUCTOS -->
    <h2 class="text-xl font-bold mb-4">Listado de Productos</h2>
    <p-table [value]="productos" [paginator]="true" [rows]="10" [responsiveLayout]="'scroll'">
      <ng-template pTemplate="header">
        <tr>
          <th>C贸digo</th>
          <th>Producto</th>
          <th>Repuesto</th>
          <th>Tipo</th>
          <th>Fabricante</th>
          <th>Modelo</th>
          <th>Peso</th>
          <th>Volumen</th>
          <th>Precio</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-prod>
        <tr>
          <td>{{ prod.codigoProducto }}</td>
          <td>{{ prod.descripcionCorta }}</td>
          <td>{{ prod.repuesto ? 'S铆' : 'No' }}</td>
          <td>{{ prod.tipoProducto }}</td>
          <td>{{ prod.fabricante }}</td>
          <td>{{ prod.modelo }}</td>
          <td>{{ prod.peso }}</td>
          <td>{{ prod.volumen }}</td>
          <td>{{ prod.precioUnitario }}</td>
          <td class="flex space-x-1">
            <button pButton icon="pi pi-link" class="p-button-sm p-button-help"
                    style="width: 2rem; height: 2rem; padding: 0;"
                    (click)="relacionar(prod)"></button>
            <button pButton icon="pi pi-pencil" class="p-button-sm p-button-info"
                    style="width: 2rem; height: 2rem; padding: 0;"
                    (click)="editar(prod)"></button>
            <button pButton icon="pi pi-trash" class="p-button-sm p-button-danger"
                    style="width: 2rem; height: 2rem; padding: 0;"
                    (click)="eliminar(prod.idProducto)"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>


  <p-dialog
  header="Ь Registrar Producto"
  [(visible)]="dialogNuevo"
  [modal]="true"
  [style]="{ width: '680px' }"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="rounded-xl"
>
  <div class="p-4 space-y-6">

    <!--  SECCIN 1: Informaci贸n general -->
    <div class="border border-gray-200 rounded-xl p-4 shadow-sm bg-gray-50">
      <h3 class="text-base font-semibold text-gray-800 mb-3 flex items-center gap-2">
        <i class="pi pi-info-circle text-blue-500"></i> Informaci贸n general
      </h3>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="text-sm font-medium text-gray-700">C贸digo</label>
          <input
            pInputText
            [(ngModel)]="nuevoProducto.CodigoProducto"
            placeholder="Ej. PROD001"
            class="w-full mt-1"
          />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Tipo Producto</label>
          <p-dropdown
            [options]="tipos"
            [(ngModel)]="nuevoProducto.IdTipoProducto"
            optionLabel="label"
            optionValue="value"
            placeholder="Seleccionar..."
            class="w-full"
          ></p-dropdown>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Descripci贸n Corta</label>
          <input
            pInputText
            [(ngModel)]="nuevoProducto.DescripcionCorta"
            placeholder="Nombre breve del producto"
            class="w-full mt-1"
          />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">驴Es Repuesto?</label>
          <div class="mt-1">
            <p-inputSwitch [(ngModel)]="nuevoProducto.repuesto"></p-inputSwitch>
          </div>
        </div>
      </div>
    </div>

    <!--  SECCIN 2: Detalle t茅cnico -->
    <div class="border border-gray-200 rounded-xl p-4 shadow-sm bg-gray-50">
      <h3 class="text-base font-semibold text-gray-800 mb-3 flex items-center gap-2">
        <i class="pi pi-cog text-blue-500"></i> Detalle t茅cnico
      </h3>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Fabricante</label>
          <p-dropdown
            [options]="fabricantes"
            [(ngModel)]="nuevoProducto.IdFabricante"
            optionLabel="label"
            optionValue="value"
            placeholder="Seleccionar..."
            class="w-full"
          ></p-dropdown>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Modelo</label>
          <p-dropdown
            [options]="modelos"
            [(ngModel)]="nuevoProducto.IdModelo"
            optionLabel="label"
            optionValue="value"
            placeholder="Seleccionar..."
            class="w-full"
          ></p-dropdown>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Familia</label>
          <p-dropdown
            [options]="familias"
            [(ngModel)]="nuevoProducto.IdFamilia"
            optionLabel="label"
            optionValue="value"
            placeholder="Seleccionar..."
            class="w-full"
          ></p-dropdown>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Descripci贸n Larga</label>
          <textarea
            pInputTextarea
            [(ngModel)]="nuevoProducto.DescripcionLarga"
            rows="2"
            class="w-full mt-1"
            placeholder="Describe el producto en detalle..."
          ></textarea>
        </div>
      </div>
    </div>

    <!--  SECCIN 3: Medidas y costos -->
    <div class="border border-gray-200 rounded-xl p-4 shadow-sm bg-gray-50">
      <h3 class="text-base font-semibold text-gray-800 mb-3 flex items-center gap-2">
        <i class="pi pi-box text-blue-500"></i> Medidas y costos
      </h3>

      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="text-sm font-medium text-gray-700">Precio (S/)</label>
          <input
            pInputText
            type="number"
            [(ngModel)]="nuevoProducto.PrecioUnitario"
            min="0"
            placeholder="0.00"
            class="w-full mt-1"
          />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Peso (kg)</label>
          <input
            pInputText
            type="number"
            [(ngModel)]="nuevoProducto.Peso"
            min="0"
            placeholder="0"
            class="w-full mt-1"
          />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Volumen (m鲁)</label>
          <input
            pInputText
            type="number"
            [(ngModel)]="nuevoProducto.Volumen"
            min="0"
            placeholder="0"
            class="w-full mt-1"
          />
        </div>
      </div>
    </div>
  </div>

  <!--  BOTONES -->
  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-3 px-4 py-2">
      <button
        pButton
        label="Cancelar"
        icon="pi pi-times"
        class="p-button-text"
        (click)="dialogNuevo = false"
      ></button>

      <button
        pButton
        [label]="modoEdicion ? 'Actualizar' : 'Guardar'"
        icon="pi pi-save"
        class="p-button-primary"
        (click)="confirmarGuardar()"
      ></button>
    </div>
  </ng-template>
</p-dialog>

