<div class="flex flex-col flex-auto min-w-0"> 
  <!-- üîπ Encabezado -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between p-6 sm:py-8 sm:px-10 border-b bg-white shadow-sm">
    <div class="flex-1 min-w-0">
      <div class="flex flex-wrap items-center font-medium text-sm text-gray-500">
        <div><a class="whitespace-nowrap text-primary-500 font-semibold">SIR</a></div>
        <div class="flex items-center ml-1 whitespace-nowrap">
          <mat-icon class="text-gray-400" [svgIcon]="'heroicons_solid:chevron-right'"></mat-icon>
          <a class="ml-1 text-primary-500 font-semibold">Maestro</a>
        </div>
        <div class="flex items-center ml-1 whitespace-nowrap">
          <mat-icon class="text-gray-400" [svgIcon]="'heroicons_solid:chevron-right'"></mat-icon>
          <span class="ml-1 text-gray-800 font-semibold">Diagn√≥stico</span>
        </div>
      </div>
      <div class="mt-2">
        <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 truncate">
          Mantenimiento de Diagn√≥sticos
        </h2>
      </div>
    </div>
  </div>

  <!-- üîπ Filtro -->
  <div class="p-6 bg-white border-b shadow-sm">
    <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center gap-2">
      <i class="pi pi-filter text-gray-500"></i> Filtro de b√∫squeda
    </h3>

    <div class="flex flex-wrap gap-4 items-end">

      <div>
        <label class="block mb-1 text-sm font-medium text-gray-600">Categor√≠a Reparaci√≥n</label>

        <!-- ‚úÖ CORREGIDO: en el filtro NO existe row -->
        <p-dropdown
          [options]="categorias"
          [(ngModel)]="filtro.idCategoriaReparacion"
          optionLabel="descripcion"
          optionValue="idCategoriaReparacion"
          placeholder="Selecciona categor√≠a"
          class="w-full">
        </p-dropdown>
      </div>

      <div class="ml-auto flex gap-2">
        <button pButton label="Buscar" icon="pi pi-search" (click)="buscar()" class="p-button-primary"></button>
        <button pButton icon="pi pi-plus" label="Nuevo" (click)="nuevo()" class="p-button-success"></button>
      </div>
    </div>
  </div>

  <!-- üîπ Tabla -->
  <div class="p-6 bg-white mt-4 rounded-lg shadow-sm">
    <h3 class="text-lg font-semibold text-gray-700 flex items-center gap-2 mb-4">
      <i class="pi pi-list text-gray-500"></i> Listado de Fallas
    </h3>

    <p-table [value]="diagnosticos" [paginator]="true" [rows]="10" [responsiveLayout]="'scroll'" class="shadow-sm">

      <ng-template pTemplate="header">
        <tr>
          <th style="width: 140px;">C√≥digo Smartway</th>
          <th>Diagn√≥stico</th>
          <th style="width: 220px;">Categor√≠a Reparaci√≥n</th>
          <th style="width: 120px; text-align: center;">Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row let-i="rowIndex">

        <!-- üîπ Fila en edici√≥n -->
        <tr *ngIf="row.editando">

          <td>
            <input pInputText [(ngModel)]="row.codigoSmartway" placeholder="Ej: DI0001" class="w-full" />
          </td>

          <td>
            <input pInputText [(ngModel)]="row.descripcion" placeholder="Descripci√≥n del diagn√≥stico" class="w-full" />
          </td>

          <td>
            <!-- ‚úÖ CORREGIDO dropdown edici√≥n -->
            <p-dropdown
              [options]="categorias"
              [(ngModel)]="row.idCategoriaReparacion"
              optionLabel="descripcion"
              optionValue="idCategoriaReparacion"
              placeholder="[--]"
              class="w-full">
            </p-dropdown>
          </td>

          <td class="text-center">
            <button pButton icon="pi pi-check" class="p-button-rounded p-button-text p-button-success"
              pTooltip="Guardar" (click)="guardar(row)">
            </button>

            <button pButton icon="pi pi-times" class="p-button-rounded p-button-text p-button-secondary"
              pTooltip="Cancelar" (click)="cancelar(row, i)">
            </button>
          </td>
        </tr>

        <!-- üîπ Fila normal -->
        <tr *ngIf="!row.editando">
          <td>{{ row.codigoSmartway }}</td>
          <td>{{ row.descripcion }}</td>
          <td>{{ row.categoriaReparacion }}</td>
          <td class="text-center">
            <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-info"
              (click)="editar(row)" pTooltip="Editar"></button>

            <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger"
              (click)="eliminar(row.idDiagnostico)" pTooltip="Eliminar"></button>
          </td>
        </tr>

      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="4" class="text-center text-gray-400 py-3">No se encontraron diagn√≥sticos</td>
        </tr>
      </ng-template>

    </p-table>
  </div>

  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
</div>
